<!DOCTYPE html>
<html>
  <head>
    <title>Yelp &amp; Open Source</title>
    <link rel="stylesheet" type="text/css" href="css/styleguide.css">
    <link rel="stylesheet" type="text/css" href="css/yelp-opensource.css">
    <link href="//netdna.bootstrapcdn.com/font-awesome/3.1.1/css/font-awesome.css" rel="stylesheet">
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>

    <script>
      $(document).ready(function() {
        var stars = 0;
        var forks = 0;
        var users = 0;
        var projects = 0;

        var not_forked = 0;
        var forked = 0;

        $.get('https://api.github.com/users/yelp/repos?per_page=100', function(data) {
          data.forEach(function(repository) {
            if (repository['fork'] === false) {
              $('.projects.not-forked').append(build_repository_container(repository));
              not_forked += 1;
            } else {
              $('.projects.forked').append(build_repository_container(repository));
              forked += 1;
            }

            stars += repository['stargazers_count'];
            forks += repository['forks_count'];
            projects = data.length;
          });

          $('.not-forked .count').html(not_forked);
          $('.forked .count').html(forked);

          $('.stats-stargazers').html(stars + " total stargazers watching our projects");
          $('.stats-forks').html(forks + " total forks on our projects");
          $('.stats-projects').html(projects + " total projects open sourced by us or being contributed to");
        });

        $.get('https://api.github.com/orgs/yelp/members', function(data) {
          users = data.length
          $('.stats-users').html("We have " + users + " users contributing to open source projects");
        });

        $('.tabs-pill li').click(function(e, that) {
          e.preventDefault();

          $('.tabs-pill li').removeClass('selected');
          $('.projects').hide();

          $(e.target.parentNode).addClass('selected');
          var container = ".projects." + $(e.target.parentNode).data('container');

          $(container).show();
        });

        var build_repository_container = function(repository) {
          return [
            '<div class="project island ', repository['language'],'">',
              '<h3>', repository['name'], '</h3>',
              '<p>', repository['description'], '</p>',
              '<div class="bottom-links">',
                '<a href="', repository['html_url'], '"><i class="icon-github"></i> View source</a> ',
                '<span class="chiclet-link"><i class="icon-star"></i> ', repository['stargazers_count'], '</span> ',
                '<span class="chiclet-link"><i class="icon-code-fork"></i> ', repository['forks_count'], '</span> ',
              '</div>',
            '</div>'
          ].join('');
        }
      });
    </script>
  </head>
  <body id="yelp_main_body" class="ytype borderless">
    <div id="wrap">
      <div class="app-header slim-header">
        <div class="header-container clearfix">
          <h1 class="logo"><a href="/">Yelp</a></h1>
          <h2 class="header-title">Open Source</h2>
        </div>
      </div>

      <div class="top-shelf top-shelf-grey">
        <div class="container">
          <div class="clearfix layout-block layout-h intro">
            <div class="column column-alpha ">
              <h1>Yelp <3 Open Source</h1>
              <p>Yelp runs on open source projects and loves to contribute back to the community with projects of our own.</p>
              <p>Take a look at projects we've open sourced and contributions we've made to existing projects.</p>
            </div>

            <div class="column column-beta">
              <p class='stats-users'>Users</p>
              <p class='stats-stargazers'>Stargazers</p>
              <p class='stats-forks'>Forks</p>
              <p class='stats-projects'>Projects</p>
            </div>
          </div>
        </div>
      </div>

      <ul class="tabs-pill">
        <li data-container="not-forked" class="tab inline-block not-forked selected">
          <a>Our open source</a><span class="count"></span>
        </li>
        <li data-container="forked" class="tab inline-block forked">
          <a>Open source we contribute to</a><span class="count"></span>
        </li>
      </ul>

      <div class="projects not-forked container">
      </div>

      <div class="projects forked container">
      </div>
    </div>
  </body>
</html>
